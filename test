// Single Nexus group repo for everything
val nexusRepo = System.getenv("NEXUS_MAVEN_GROUP")
    ?: "https://nexus.yourcompany.com/repository/maven-group/"

// Use Nexus for all dependencies
allprojects {
    repositories {
        clear()
        maven { setUrl(nexusRepo) }
    }
}

// Use Nexus for Gradle plugins too
gradle.settingsEvaluated {
    pluginManagement {
        repositories {
            clear()
            maven { setUrl(nexusRepo) }
        }
    }
}

// (Optional) Block direct internet repos
gradle.beforeProject {
    repositories.whenObjectAdded {
        if (this is org.gradle.api.artifacts.repositories.MavenArtifactRepository &&
            !url.toString().startsWith(nexusRepo)) {
            throw org.gradle.api.GradleException("External repos are blocked. Use Nexus: $nexusRepo")
        }
    }
}